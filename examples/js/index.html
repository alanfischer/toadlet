<html>
<head>
<title>Toadlet Example</title>
</head>
<canvas width="512" height="512" id="canvas" oncontextmenu="return false;"></canvas>
</body>

<script type="text/javascript">
var renderDevice;
var scene;
var cameraComponent;

var update=function(){
	var t=(new Date()).getTime()/1000.0;
	var camera=cameraComponent.getCamera();
	
	cameraComponent.setLookAt([Math.cos(t)*10,Math.sin(t)*10,10],[0,0,0],[0,0,1]);
	
	scene.update(33);
	
	renderDevice.beginScene();
		camera.render(renderDevice,scene,null);
	renderDevice.endScene();
	
	window.setTimeout(update,33);
};

var init=function(){
	var renderTarget=Module.new_EGLWindowRenderTarget(document.getElementById("canvas"));
	renderDevice=Module.new_GLES2RenderDevice();
	renderDevice.create(renderTarget,0);
	
	var engine=new Module.Engine();
	engine.setRenderDevice(renderDevice);
	engine.installHandlers();
	
	scene=new Module.Scene(engine);
	var root=scene.getRoot();

	var camera=new Module.Camera(engine);
	var cameraNode=new Module.Node(scene);
	cameraComponent=new Module.CameraComponent(camera);
	cameraNode.attach(cameraComponent);
	root.attach(cameraNode);
	cameraComponent.setLookAt([0,10,10],[0,0,0],[0,0,1]);
	cameraNode.delete();
	camera.delete();
	
	var material=engine.createDiffuseMaterial(null,null);
	var mesh=engine.createTorusMesh(2,1,16,16,material);
	var meshComponent=new Module.MeshComponent(engine);
	var meshNode=new Module.Node(scene);
	meshComponent.setMeshWithMesh(mesh);
	meshNode.attach(meshComponent);
	root.attach(meshNode);
	meshNode.delete();
	meshComponent.delete();
	mesh.delete();
	material.delete();

	engine.delete();
	
	update();
};

var script=document.createElement("script");
script.type="text/javascript";
script.src="toadlet.js";
script.onreadystatechange=init;
script.onload=init;
document.getElementsByTagName("head")[0].appendChild(script);

</script>
</html>
