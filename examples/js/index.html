<html>
<head>

<script type="text/javascript" src="toadlet.js"></script>
<script type="text/javascript">
var renderDevice;
var engine;
var scene;
var cameraComponent;

function update(){
	var t=(new Date()).getTime()/1000.0;

	cameraComponent.setLookAt([Math.cos(t)*10,Math.sin(t)*10,10],[0,0,0],[0,0,1]);
	
	scene.update(33);
	
	renderDevice.beginScene();
		cameraComponent.render(renderDevice,scene,null);
	renderDevice.endScene();

	window.setTimeout(update,33);
};

function init(){
	var renderTarget=toadlet.new_EGLWindowRenderTarget(document.getElementById("canvas"));
	renderDevice=toadlet.new_GLES2RenderDevice();
	renderDevice.create(renderTarget,0);

	engine=new toadlet.Engine();
	engine.setRenderDevice(renderDevice);
	engine.installHandlers();
	
	scene=new toadlet.Scene(engine);
	var root=scene.getRoot();

	var camera=new toadlet.Camera(engine);
	var cameraNode=new toadlet.Node(scene);
	cameraComponent=new toadlet.CameraComponent(camera);
	cameraNode.attach(cameraComponent);
	root.attach(cameraNode);
	cameraComponent.setLookAt([0,10,10],[0,0,0],[0,0,1]);
	cameraNode.delete();
	camera.delete();

	var request=toadlet.ResourceRequest.implement({
		resourceReady: function(resource){
			var material=engine.createDiffuseMaterial(toadlet.toTexture(resource),null);
			var mesh=engine.createTorusMesh(2,1,6,6,material);
			var meshComponent=new toadlet.MeshComponent(engine);
			var meshNode=new toadlet.Node(scene);
			meshComponent.setMeshWithMesh(mesh);
			meshNode.attach(meshComponent);
			root.attach(meshNode);
			meshNode.delete();
			meshComponent.delete();
			mesh.delete();
			material.delete();
			if(resource!=null){
				resource.delete();
			}
		},
		resourceException: function(ex){
			console.log(ex.getDescription());
			this.resourceReady(null);
		}
	});
	
	var textureManager=engine.getTextureManager();
	textureManager.find("sparkle.png",request,null);
	
	update();
};
</script>

<title>Toadlet Example</title>
</head>
<body onload="init();">
<canvas width="512" height="512" id="canvas" oncontextmenu="return false;"></canvas>
</body>
</html>
