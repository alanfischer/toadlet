This code is based on gpp-2.24.
